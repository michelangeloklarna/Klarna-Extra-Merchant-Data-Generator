<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple EMD Generator Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        #output {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            min-height: 100px;
            white-space: pre-wrap;
        }
        #emd-size-display {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f8f8f8;
            border-radius: 3px;
            font-size: 14px;
        }
        .size-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .size-value {
            font-family: 'Courier New', monospace;
            color: #007bff;
        }
        .size-warning {
            color: #ff4500;
            margin-top: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Simple EMD Generator Test</h1>
        
        <div class="form-section">
            <h2>Air Reservation Details</h2>
            
            <div class="form-group">
                <label for="pnr">PNR (Passenger Name Record)</label>
                <input type="text" id="pnr" placeholder="Example: Y2YWJ">
            </div>
            
            <h3>Itinerary</h3>
            
            <div class="form-group">
                <label for="departure">Departure Airport (3-letter IATA code)</label>
                <input type="text" id="departure" placeholder="Example: AMS">
            </div>
            
            <div class="form-group">
                <label for="departure_city">Departure City</label>
                <input type="text" id="departure_city" placeholder="Example: Amsterdam">
            </div>
            
            <div class="form-group">
                <label for="arrival">Arrival Airport (3-letter IATA code)</label>
                <input type="text" id="arrival" placeholder="Example: LHR">
            </div>
            
            <div class="form-group">
                <label for="arrival_city">Arrival City</label>
                <input type="text" id="arrival_city" placeholder="Example: London">
            </div>
            
            <div class="form-group">
                <label for="carrier">Carrier (2-letter IATA code)</label>
                <input type="text" id="carrier" placeholder="Example: KL">
            </div>
            
            <div class="form-group">
                <label for="segment_price">Segment Price (in minor units)</label>
                <input type="text" id="segment_price" placeholder="Example: 10000">
            </div>
        </div>
        
        <button id="generate-btn">Generate EMD</button>
        
        <div id="emd-size-display"></div>
        <div id="output"></div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up event listeners');
            
            document.getElementById('generate-btn').addEventListener('click', function() {
                console.log('Generate button clicked');
                generateEMD();
            });
        });
        
        /**
         * Calculates the byte size of a string
         * @param {string} str - The string to calculate the size of
         * @return {number} The size in bytes
         */
        function calculateByteSize(str) {
            // Use TextEncoder to get accurate byte size for Unicode characters
            return new TextEncoder().encode(str).length;
        }
        
        /**
         * Calculates and displays the EMD size information
         * @param {Object} emdData - The EMD data object
         */
        function calculateAndDisplayEMDSize(emdData) {
            const emdJsonString = JSON.stringify(emdData);
            const emdSize = calculateByteSize(emdJsonString);
            
            // Update the display with size information
            const sizeDisplay = document.getElementById('emd-size-display');
            sizeDisplay.innerHTML = `
                <div class="size-label">EMD Size: <span class="size-value">${emdSize} bytes</span></div>
                ${emdSize > 1000 ? `<div class="size-warning">Warning: EMD is ${(emdSize/1000).toFixed(2)} KB. Klarna recommends keeping EMD compact.</div>` : ''}
            `;
        }
        
        function generateEMD() {
            console.log('Generating EMD...');
            
            // Get values from form
            const pnr = document.getElementById('pnr').value;
            const departure = document.getElementById('departure').value;
            const departureCity = document.getElementById('departure_city').value;
            const arrival = document.getElementById('arrival').value;
            const arrivalCity = document.getElementById('arrival_city').value;
            const carrier = document.getElementById('carrier').value;
            const segmentPrice = document.getElementById('segment_price').value;
            
            console.log('Form values:', {
                pnr, departure, departureCity, arrival, arrivalCity, carrier, segmentPrice
            });
            
            // Create EMD object
            const emd = {
                air_reservation_details: [
                    {
                        pnr: pnr,
                        itinerary: [
                            {
                                departure: departure,
                                departure_city: departureCity,
                                arrival: arrival,
                                arrival_city: arrivalCity,
                                carrier: carrier,
                                segment_price: segmentPrice
                            }
                        ]
                    }
                ]
            };
            
            console.log('Generated EMD:', emd);
            
            // Calculate and display the EMD size
            calculateAndDisplayEMDSize(emd);
            
            // Display EMD
            document.getElementById('output').textContent = JSON.stringify(emd, null, 2);
        }
    </script>
</body>
</html> 